import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as e,c as o,b as c,d as n,e as a,a as l,f as i}from"./app-BrScejxt.js";const u={},r=n("div",{class:"hint-container note"},[n("p",{class:"hint-container-title"},"注"),n("p",null,"此处是一些 SpringCloud 的基础知识（持续更新中...）。")],-1),k=n("h2",{id:"服务注册和发现",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#服务注册和发现"},[n("span",null,"服务注册和发现")])],-1),d={class:"hint-container tip"},g=n("p",{class:"hint-container-title"},"目前开源的注册中心框架。",-1),m=n("p",null,"Eureka：Netflix 公司出品，目前被集成在 SpringCloud 当中，一般用于 Java 应用。",-1),v={href:"https://nacos.io/zh-cn/",target:"_blank",rel:"noopener noreferrer"},h=n("p",null,"Consul：HashiCorp 公司出品，目前集成在 SpringCloud 中，不限制微服务语言。",-1),b=i(`<h3 id="nacos" tabindex="-1"><a class="header-anchor" href="#nacos"><span>Nacos</span></a></h3><div class="hint-container info"><p class="hint-container-title">使用 Docker 安装 Nacos。</p><p>请查看 Docker 学习笔记中“安装各类软件”章节介绍。</p></div><h4 id="服务注册" tabindex="-1"><a class="header-anchor" href="#服务注册"><span>服务注册</span></a></h4><ol><li><p>添加依赖：</p><p>注意：前提需要先引入 SpringCloudAlibaba 的依赖。</p><div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- Nacos 服务注册发现 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li><li><p>配置 Nacos：</p><p>在 <code>application.yml</code> 配置文件中添加以下配置。</p><div class="language-yaml" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>demo <span class="token comment"># 服务名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># Nacos 服务地址</span>
</code></pre></div></li><li><p>启动服务实例 - 查看 Nacos 服务列表。</p></li></ol><h4 id="服务发现" tabindex="-1"><a class="header-anchor" href="#服务发现"><span>服务发现</span></a></h4><ol><li><p>添加依赖：</p><div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- Nacos 服务注册发现 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li><li><p>配置 Nacos：</p><div class="language-yaml" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
</code></pre></div></li><li><p>发现并调用服务。</p><p>常见的负载均衡算法有：随机、轮询、IP 的 Hash、最近最少访问、...。</p></li></ol><h3 id="openfeign" tabindex="-1"><a class="header-anchor" href="#openfeign"><span>OpenFeign</span></a></h3><ol><li><p>添加依赖：</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>  <span class="token comment">&lt;!-- OpenFeign --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 负载均衡器 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>启用 OpenFeign：</p><p>在启动类或者配置类上添加 <code>@EnableFeignClients</code> 注解启用 OpenFeign。</p></li><li><p>编写 OpenFeign 客户端：</p><ol><li><p>新建 client 包。</p></li><li><p>使用 <code>@FeignClient</code> 注解声明客户端。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>chenwenjing<span class="token punctuation">.</span>cart<span class="token punctuation">.</span>client</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>chenwenjing<span class="token punctuation">.</span>cart<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">ItemDTO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">&quot;item-service&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 声明服务名称</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ItemClient</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/items&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 声明请求方式和请求路径</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ItemDTO</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryItemByIds</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;ids&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 声明请求参数和返回值</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>使用 FeignClient：</p><p>在需要远程调用的地方，类似本地方法的调用方式，直接调用即可。</p><p>OpenFeign 替我们完成了服务拉取、负载均衡、发送 HTTP 请求的所有工作。</p></li></ol></li><li><p>配置连接池：</p><p>OpenFeign 底层发起 HTTP 请求，依赖于其它的框架。</p><p>其底层支持的 HTTP 客户端实现包括：</p><ul><li>HttpURLConnection（默认实现 - 不支持连接池）。</li><li>Apache HttpClient（支持连接池）。</li><li>OKHttp（支持连接池）。</li></ul><p>因此我们通常会使用带有连接池的客户端来代替默认的 HttpURLConnection - 比如 OKHttp。</p></li><li><p>引入依赖：</p><div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- OKHttp --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>feign-okhttp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li><li><p>开启连接池：</p><div class="language-yaml" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">okhttp</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 开启 OKHttp 功能</span>
</code></pre></div></li><li><p>验证：</p><p>可以在 <code>org.springframework.cloud.openfeign.loadbalancer.FeignBlockingLoadBalancerClient</code> 类中的 <code>execute</code> 方法上打个断点查看。</p></li></ol>`,8);function y(f,x){const s=p("ExternalLinkIcon");return e(),o("div",null,[r,c(" more "),k,n("div",d,[g,m,n("p",null,[n("a",v,[a("Nacos"),l(s)]),a("：Alibaba 公司出品，目前被集成在 SpringCloudAlibaba 中，一般用于 Java 应用。")]),h]),b])}const I=t(u,[["render",y],["__file","index.html.vue"]]),N=JSON.parse('{"path":"/notes/spring/spring-cloud/","title":"SpringCloud","lang":"zh-CN","frontmatter":{"title":"SpringCloud","icon":"spring-cloud","category":["Spring","SpringCloud"],"timeline":true,"star":true,"description":" 注 此处是一些 SpringCloud 的基础知识（持续更新中...）。 服务注册和发现 目前开源的注册中心框架。 Eureka：Netflix 公司出品，目前被集成在 SpringCloud 当中，一般用于 Java 应用。 Nacos：Alibaba 公司出品，目前被集成在 SpringCloudAlibaba 中，一般用于 Java 应用。 C...","head":[["meta",{"property":"og:url","content":"https://SuperChenWenjing.github.io/notes/spring/spring-cloud/"}],["meta",{"property":"og:site_name","content":"陈文景"}],["meta",{"property":"og:title","content":"SpringCloud"}],["meta",{"property":"og:description","content":" 注 此处是一些 SpringCloud 的基础知识（持续更新中...）。 服务注册和发现 目前开源的注册中心框架。 Eureka：Netflix 公司出品，目前被集成在 SpringCloud 当中，一般用于 Java 应用。 Nacos：Alibaba 公司出品，目前被集成在 SpringCloudAlibaba 中，一般用于 Java 应用。 C..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-06T13:02:02.000Z"}],["meta",{"property":"article:author","content":"陈文景"}],["meta",{"property":"article:modified_time","content":"2024-05-06T13:02:02.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SpringCloud\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-06T13:02:02.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"陈文景\\",\\"email\\":\\"2646530197@qq.com\\",\\"url\\":\\"https://superchenwenjing.github.io\\"}]}"]],"date":"2024-04-06T05:24:10.000Z"},"headers":[{"level":2,"title":"服务注册和发现","slug":"服务注册和发现","link":"#服务注册和发现","children":[{"level":3,"title":"Nacos","slug":"nacos","link":"#nacos","children":[]},{"level":3,"title":"OpenFeign","slug":"openfeign","link":"#openfeign","children":[]}]}],"git":{"createdTime":1712381050000,"updatedTime":1715000522000,"contributors":[{"name":"陈文景","email":"2646530197@qq.com","commits":3}]},"readingTime":{"minutes":2.17,"words":652},"filePathRelative":"notes/spring/spring-cloud/README.md","localizedDate":"2024年4月6日","excerpt":"<div class=\\"hint-container note\\">\\n<p class=\\"hint-container-title\\">注</p>\\n<p>此处是一些 SpringCloud 的基础知识（持续更新中...）。</p>\\n</div>\\n","autoDesc":true}');export{I as comp,N as data};
